{% extends "base.html.twig" %}

{% block containerLeft %}
    <div id="batchContainer" data-index="1" data-lock="" data-count="99">
    {% for category in categories %}
        <h1>{{ category.name }}</h1>

    {% endfor %}

    {% include 'archive/batch.html.twig' %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        $(window).scroll(function() {
            if ($(window).scrollTop() + $(window).height() < $(document).height() - 100) return;

            var batchContainer = $('#batchContainer');
            var lock = batchContainer.attr('data-lock');
            var count = batchContainer.attr('data-count');

            if (lock) return;

            batchContainer.attr('data-lock', true);
            var index = batchContainer.attr('data-index');

            if (index >= count) return;

            $.get('{{ path('archive_ajax_repopulate') }}' + '/' + (index++), null, function(response) {
                batchContainer.html(batchContainer.html() + response.view);

                batchContainer.attr('data-index', index);
                batchContainer.attr('data-lock', '');
                batchContainer.attr('data-count', response.count);
            });
        });
    </script>
{% endblock %}